import Dropdown from"./components/Dropdown.js";import LoadingIcon from"./components/LoadingIcon.js";import SearchBar from"./components/SearchBar.js";import HospitalsDisplay from"./pages/hospital/HospitalDisplay.js";const{useEffect,useState,useReducer}=React,apiUrl=location.origin+"/api/data/",cache=new Map;document.addEventListener("DOMContentLoaded",function(){ReactDOM.render(/*#__PURE__*/React.createElement(Hospitals,null),document.getElementById("root"))});function Hospitals(){const[a,b]=useState(STATS_DATA.state_names[15]),[{searchQuery:d,hospitals:e,filtered:f},c]=useReducer(updateHospitals,{searchQuery:"",hospitals:null,filtered:null,region:null}),[g,h]=useState("");return useEffect(()=>{const b=a;getRegionDataByName(b).then(a=>(a||="Failed to fetch Data","string"==typeof a?h(a+", Contact a developer if the issue persists"):void(a.data=a.data.sort((c,a)=>a.available_beds_with_oxygen-c.available_beds_with_oxygen),c({values:a.data,region:b})))).catch(console.error)},[a]),g?/*#__PURE__*/React.createElement("span",{color:"red"}," ",g," "):e&&e.region===a?/*#__PURE__*/React.createElement("div",{id:"display"},/*#__PURE__*/React.createElement(SearchBar,{searchQuery:d,setSearchQuery:c}),/*#__PURE__*/React.createElement("div",{id:"dropDown-bar"},/*#__PURE__*/React.createElement(Dropdown,{options:STATS_DATA.state_names,value:a,onChange:({value:a})=>b(a)}),/*#__PURE__*/React.createElement(RegionDropDown,{hospitals:e,setSearchQuery:c})),/*#__PURE__*/React.createElement(HospitalsDisplay,{hospitals:f})):/*#__PURE__*/React.createElement("div",{id:"loadingDisplay",style:{display:"grid",placeItems:"center"}}," ",/*#__PURE__*/React.createElement(LoadingIcon,null)," ")}function RegionDropDown({hospitals:a,setSearchQuery:b}){const[c,d]=useState(null);return useEffect(()=>{d(["All Regions",...new Set(a.values.map(a=>a.area||"NA"))])},[a]),a&&c?/*#__PURE__*/React.createElement(Dropdown,{options:c,value:"All Regions",onChange:({value:a})=>b({type:"region",region:a})}):/*#__PURE__*/React.createElement("div",{id:"loadingDisplay",style:{display:"grid",placeItems:"center"}}," ",/*#__PURE__*/React.createElement(LoadingIcon,null)," ")}function updateHospitals(a,b){// update search Query
if("string"==typeof b||!b)return{...a,searchQuery:b,filtered:filterHospitals(a.hospitals,b,a.region)};if(b instanceof Object&&b.values&&b.region)return{...a,hospitals:b,filtered:filterHospitals(b,a.searchQuery,a.region)};if(b instanceof Object&&"region"===b.type&&b.region)return{...a,region:b.region,filtered:filterHospitals(a.hospitals,a.searchQuery,b.region)};throw new Error}function filterHospitals(a,b,c){if(!a||0===a.values?.length)return[];let d=a.values;return(c&&"All Regions"!==c&&(d=d.filter(a=>a.area===c)),!b||""===b)?d:(d=d.filter(a=>a.hospital_name.toLowerCase().includes(b.toLowerCase())),d)}async function getRegionDataByName(a){const b=STATS_DATA.code_names[STATS_DATA.state_names.indexOf(a)];if(!b)return"Invalid State Name";const c=cache.get(b);if(c)return c;const d=fetch(`${apiUrl}?name=${b}`).then(a=>a.json()).catch(console.error);return cache.set(b,d),d?await d:"Failed to fetch data from API"}//  FETCH TO CACHE
getRegionDataByName(STATS_DATA.state_names[15]);