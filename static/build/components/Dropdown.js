/* eslint-disable jsx-a11y/no-static-element-interactions */ /* eslint-disable jsx-a11y/interactive-supports-focus */ /* eslint-disable jsx-a11y/click-events-have-key-events */ /* eslint-disable react/prop-types */const{Component,createRef}=React,classNames=a=>// eslint-disable-next-line no-return-assign
Object.entries(a).reduce((a,[b,c])=>a+=c?` ${b}`:"",""),DEFAULT_PLACEHOLDER_STRING="Select...";class Dropdown extends Component{constructor(a){super(a),this.state={selected:this.parseValue(a.value,a.options)||{label:"undefined"==typeof a.placeholder?DEFAULT_PLACEHOLDER_STRING:a.placeholder,value:""},isOpen:!1},this.dropdownRef=createRef(),this.mounted=!0,this.handleDocumentClick=this.handleDocumentClick.bind(this),this.fireChangeEvent=this.fireChangeEvent.bind(this)}componentDidUpdate(a){if(this.props.value!==a.value)if(this.props.value){const a=this.parseValue(this.props.value,this.props.options);a!==this.state.selected&&this.setState({selected:a})}else this.setState({selected:{label:"undefined"==typeof this.props.placeholder?DEFAULT_PLACEHOLDER_STRING:this.props.placeholder,value:""}})}componentDidMount(){document.addEventListener("click",this.handleDocumentClick,!1),document.addEventListener("touchend",this.handleDocumentClick,!1)}componentWillUnmount(){this.mounted=!1,document.removeEventListener("click",this.handleDocumentClick,!1),document.removeEventListener("touchend",this.handleDocumentClick,!1)}handleMouseDown(a){this.props.onFocus&&"function"==typeof this.props.onFocus&&this.props.onFocus(this.state.isOpen);"mousedown"===a.type&&0!==a.button||(a.stopPropagation(),a.preventDefault(),!this.props.disabled&&this.setState({isOpen:!this.state.isOpen}))}parseValue(a,b){let c;if("string"==typeof a)for(let d=0,e=b.length;d<e;d++)if("group"===b[d].type){const e=b[d].items.filter(b=>b.value===a);e.length&&(c=e[0])}else"undefined"!=typeof b[d].value&&b[d].value===a&&(c=b[d]);return c||a}setValue(a,b){const c={selected:{value:a,label:b},isOpen:!1};this.fireChangeEvent(c),this.setState(c)}fireChangeEvent(a){a.selected!==this.state.selected&&this.props.onChange&&this.props.onChange(a.selected)}renderOption(a){let b=a.value;"undefined"==typeof b&&(b=a.label||a);const c=a.label||a.value||a,d=b===this.state.selected.value||b===this.state.selected,e={[`${this.props.baseClassName}-option`]:!0,[a.className]:!!a.className,"is-selected":d},f=classNames(e);return/*#__PURE__*/React.createElement("div",{key:b,className:f,onMouseDown:this.setValue.bind(this,b,c),onClick:this.setValue.bind(this,b,c),role:"option","aria-selected":d?"true":"false"},c)}buildMenu(){const{options:a,baseClassName:b}=this.props,c=a.map(a=>{if("group"===a.type){const c=/*#__PURE__*/React.createElement("div",{className:`${b}-title`},a.name),d=a.items.map(a=>this.renderOption(a));return/*#__PURE__*/React.createElement("div",{className:`${b}-group`,key:a.name,role:"listbox",tabIndex:"-1"},c,d)}return this.renderOption(a)});return c.length?c:/*#__PURE__*/React.createElement("div",{className:`${b}-noresults`},"No options found")}handleDocumentClick(a){this.mounted&&!this.dropdownRef.current.contains(a.target)&&this.state.isOpen&&this.setState({isOpen:!1})}isValueSelected(){return"string"==typeof this.state.selected||""!==this.state.selected.value}render(){const{baseClassName:a,controlClassName:b,placeholderClassName:c,menuClassName:d,arrowClassName:e,arrowClosed:f,arrowOpen:g,className:h}=this.props,i=this.props.disabled?"Dropdown-disabled":"",j="string"==typeof this.state.selected?this.state.selected:this.state.selected.label,k=classNames({[`${a}-root`]:!0,[h]:!!h,"is-open":this.state.isOpen}),l=classNames({[`${a}-control`]:!0,[b]:!!b,[i]:!!i}),m=classNames({[`${a}-placeholder`]:!0,[c]:!!c,"is-selected":this.isValueSelected()}),n=classNames({[`${a}-menu`]:!0,[d]:!!d}),o=classNames({[`${a}-arrow`]:!0,[e]:!!e}),p=/*#__PURE__*/React.createElement("div",{className:m},j),q=this.state.isOpen?/*#__PURE__*/React.createElement("div",{className:n,"aria-expanded":"true"},this.buildMenu()):null;return/*#__PURE__*/React.createElement("div",{ref:this.dropdownRef,className:k},/*#__PURE__*/React.createElement("div",{className:l,onMouseDown:this.handleMouseDown.bind(this),onTouchEnd:this.handleMouseDown.bind(this),"aria-haspopup":"listbox"},p,/*#__PURE__*/React.createElement("div",{className:`${a}-arrow-wrapper`},g&&f?this.state.isOpen?g:f:/*#__PURE__*/React.createElement("span",{className:o}))),q)}}Dropdown.defaultProps={baseClassName:"Dropdown"};export default Dropdown;